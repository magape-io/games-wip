function again(){window.location=window.location.href}$(function(){function o(){$(".listBigImg,.listBigImg img").css("width",r+"px"),$(".listBigImg,.listBigImg img").css("height",r+"px")}function u(){$(".listSmallImg,.listSmallImg img").css("width",i+"px"),$(".listSmallImg,.listSmallImg img").css("height",i+"px")}function c(e,t){var n=Math.min.apply(null,e),r=Math.min.apply(null,t),i=[],s=[];for(var o=0;o<e.length;o++)e[o]==n&&(i[i.length]=o);for(var o=0;o<t.length;o++)t[o]==r&&(s[s.length]=o);for(var o=0;o<i.length;o++)for(var u=0;u<s.length;u++)if(i[o]==s[u])return s[u]<=8?"0"+(s[u]+1):s[u]+1}function h(){var e=!1;return $(".listSmallImg div").each(function(t,n){if($(n).data("touched"))return e=!0,!0}),e?e:($(".listBigImg div").each(function(t,n){if($(n).data("touched"))return e=!0,!0}),e)}function m(){second++,second>=10&&(second=0,minute++),$(p).html(g(minute)+":"+g(second))}function y(){v=setInterval(m,100)}$("body").append('<div id="loading"></div><div id="loadingBg"></div>');var e=function(e){$("body").append('<div id="blockBody"></div><div id="newAlert">'+e+'<div class="alertBtns"><a href="javascript:void(0)" onclick="again();">再来一次</a></div></div>'),$("#newAlert").css("margin-top",-$("#newAlert").height()/2+"px"),$("#newAlert").css("margin-left","-110px")};$(".alertBtns a").live("click",function(){$("#loading,#loadingBg").show(),$("#blockBody,#newAlert").hide()}),$("#puzzle,.listSmallImgs,.puzzleHead").css("width",$("body").width()*.8+"px");var t=$("#timer").html(),n=$("#puzzle").width(),r=n/3-4,i=n/5-4,s=r/2;u(),o();var a=$(".listBigImgs .listBigImg").length,f=function(){if($(".listBigImgs img").length<a)return;for(var n=0;n<a;n++)if($(".listBigImgs .listBigImg").eq(n).attr("mark")!=$(".listBigImgs .listBigImg").eq(n).find("img").attr("mark")){clearInterval(v),e("拼图失败~~");return}clearInterval(v),t=$("#timer").html(),t=t.replace(":",".");if(parseInt(t)>3600){$("#loadingBg").show(),e("您已超时,请新刷新页面重新开始玩游戏");return}$("#loadingBg").show(),$(".puzzleComplete").show(),$("#timeNum").html($("#timer").html()),$("#rank").html(parseInt($("#timer").html()))},l=!1;$(".listSmallImg div").each(function(e,t){t.addEventListener("touchstart",function(e){if($(t).find("img").length==0)return;if(h())return;$(t).data("touched",!0),$(t).data("smalImg",$(t).html())}),t.addEventListener("touchmove",function(e){if($(t).find("img").length==0)return;if(!$(t).data("touched"))return;if(e.targetTouches.length==1){e.preventDefault();var n=e.targetTouches[0];$(t).offset({left:n.pageX-25-s*1,top:n.pageY-25-s*1}),$(t).find("img").animate({width:r+"px",height:r+"px"},0);var i=$(t).offset().left,o=$(t).offset().top;$(t).data("offLeftSmall",i),$(t).data("offTopSmall",o),$(t).data("bigImg",$(t).html())}},!1),t.addEventListener("touchend",function(e){if($(t).find("img").length==0)return;$(t).removeData("touched");var n=$(t).data("offLeftSmall"),i=$(t).data("offTopSmall"),s=Math.abs($("#listBigImg_01").offset().left-n),o=Math.abs($("#listBigImg_02").offset().left-n),l=Math.abs($("#listBigImg_03").offset().left-n),h=Math.abs($("#listBigImg_04").offset().left-n),p=Math.abs($("#listBigImg_05").offset().left-n),d=Math.abs($("#listBigImg_06").offset().left-n),v=Math.abs($("#listBigImg_07").offset().left-n),m=Math.abs($("#listBigImg_08").offset().left-n),g=Math.abs($("#listBigImg_09").offset().left-n),y=Math.abs($("#listBigImg_01").offset().top-i),b=Math.abs($("#listBigImg_02").offset().top-i),w=Math.abs($("#listBigImg_03").offset().top-i),E=Math.abs($("#listBigImg_04").offset().top-i),S=Math.abs($("#listBigImg_05").offset().top-i),x=Math.abs($("#listBigImg_06").offset().top-i),T=Math.abs($("#listBigImg_07").offset().top-i),N=Math.abs($("#listBigImg_08").offset().top-i),C=Math.abs($("#listBigImg_09").offset().top-i),k=c([s,o,l,h,p,d,v,m,g],[y,b,w,E,S,x,T,N,C]),L=r-Math.abs($("#listBigImg_"+k).offset().top-i),A=r-Math.abs($("#listBigImg_"+k).offset().left-n);if(L/r>.55&&A/r>.55){if($(t).html()=="")return;if($("#listBigImg_"+k).html()!=""){var O=$("#listBigImg_"+k).html();$("#listBigImg_"+k).html($(t).data("bigImg"));for(var M=0;M<a;M++)$(".listSmallImgs .listSmallImg").eq(M).attr("mark")==$(O).attr("mark")&&($(".listSmallImgs .listSmallImg").eq(M).find("div").html(O),$(t).html(""),$(t).animate({position:"relative",left:"0",top:"0"},1),$(".listSmallImgs .listSmallImg").animate({position:"relative",left:"0",top:"0"},1),u());return}$("#listBigImg_"+k).html($(t).data("bigImg")),$(t).html(""),$(t).animate({position:"relative",left:"0",top:"0"},1),f()}else $(t).html($(t).data("smalImg"));$(t).animate({position:"relative",left:"0",top:"0"},1),$(t).find("img").animate({position:"relative",left:"0",top:"0"},1),$(t).removeData("smalImg"),$(t).removeData("bigImg"),$(t).removeData("offLeftSmall"),$(t).removeData("offTopSmall");return})}),$(".listBigImg div").each(function(e,t){t.addEventListener("touchstart",function(e){if($(t).find("img").length==0)return;if(h())return;$(t).data("touched",!0),$(t).data("bigImg",$(t).html())}),t.addEventListener("touchmove",function(e){if($(t).find("img").length==0)return;if(!$(t).data("touched"))return;if($(t).data("bigImg")==""){$(t).removeData("touched");return}if(e.targetTouches.length==1){e.preventDefault();var n=e.targetTouches[0];$(t).find("img").offset({left:n.pageX-25-s*1,top:n.pageY-25-s*1}),$(t).find("img").animate({width:r+"px",height:r+"px"},1);var i=$(t).find("img").offset().left,o=$(t).find("img").offset().top;$(t).data("offLeftBig",i),$(t).data("offTopBig",o)}},!1),t.addEventListener("touchend",function(e){if($(t).find("img").length==0)return;$(t).removeData("touched");var n=$(t).data("offLeftBig"),i=$(t).data("offTopBig"),s=Math.abs($("#listBigImg_01").offset().left-n),o=Math.abs($("#listBigImg_02").offset().left-n),l=Math.abs($("#listBigImg_03").offset().left-n),h=Math.abs($("#listBigImg_04").offset().left-n),p=Math.abs($("#listBigImg_05").offset().left-n),d=Math.abs($("#listBigImg_06").offset().left-n),v=Math.abs($("#listBigImg_07").offset().left-n),m=Math.abs($("#listBigImg_08").offset().left-n),g=Math.abs($("#listBigImg_09").offset().left-n),y=Math.abs($("#listBigImg_01").offset().top-i),b=Math.abs($("#listBigImg_02").offset().top-i),w=Math.abs($("#listBigImg_03").offset().top-i),E=Math.abs($("#listBigImg_04").offset().top-i),S=Math.abs($("#listBigImg_05").offset().top-i),x=Math.abs($("#listBigImg_06").offset().top-i),T=Math.abs($("#listBigImg_07").offset().top-i),N=Math.abs($("#listBigImg_08").offset().top-i),C=Math.abs($("#listBigImg_09").offset().top-i),k=c([s,o,l,h,p,d,v,m,g],[y,b,w,E,S,x,T,N,C]),L=r-Math.abs($("#listBigImg_"+k).offset().top-i),A=r-Math.abs($("#listBigImg_"+k).offset().left-n);if(i>=$(".listBigImgs").height()){for(var O=0;O<a;O++)$(".listSmallImgs .listSmallImg").eq(O).attr("mark")==$($(t).data("bigImg")).attr("mark")&&($(".listSmallImgs .listSmallImg").eq(O).find("div").html($(t).data("bigImg")),$(t).html(""),$(t).animate({position:"relative",left:"0",top:"0"},1),u());return}if(L/r>.5&&A/r>.5){if($("#listBigImg_"+k).find("img").attr("mark")!=$($(t).data("bigImg")).attr("mark"))if($("#listBigImg_"+k).html()=="")$("#listBigImg_"+k).html($(t).data("bigImg")),$(t).html("");else{var M=$("#listBigImg_"+k).html();$("#listBigImg_"+k).html($(t).data("bigImg")),$(t).html(M),$(t).animate({position:"relative",left:"0",top:"0"},1),u()}else $(t).html($(t).data("bigImg")),$(t).animate({position:"relative",left:"0",top:"0"},1);f()}else $(t).html($(t).data("bigImg")),$(t).animate({position:"relative",left:"0",top:"0"},1);$(t).removeData("offLeftBig"),$(t).removeData("offTopBig"),$(t).removeData("bigImg");return})});var p=$("#timer"),d=minute=second=0,v;$(p).html("00:00");var g=function(e){return e>=10?e:"0"+e};$(".puzzleStart").click(function(){$(".puzzleStart,#loadingBg").hide(),y()}),$(".btnUp").click(function(){var e=$(this).attr("mark");$(".photo,.puzzleRule").hide(),$("."+e).show();if(e=="photo"||e=="puzzleRule"){$("#photoBg").show();return}$("#loadingBg").show()}),$(".close").click(function(){$("."+$(this).attr("mark")).hide();if($(this).attr("mark")=="photo"||$(this).attr("mark")=="puzzleRule"){$("#photoBg").hide();return}$("#loadingBg").hide(),$(this).attr("mark")=="puzzleComplete"&&(window.location=window.location.href)}),$(".btnRule").css("left",$("#puzzle").offset().left+$("#puzzle").width()-$(".btnRule").width()+"px")}),document.getElementById("puzzle").ontouchstart=function(e){e&&e.preventDefault&&e.preventDefault()},document.getElementById("puzzle").ontouchmove=function(e){e&&e.preventDefault&&e.preventDefault()},document.getElementById("puzzle").ontouchend=function(e){e&&e.preventDefault&&e.preventDefault()}